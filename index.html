<html>
<head>
<script type="text/javascript" src="https://www.google.com/jsapi"></script>
<script type="text/javascript">google.load("jquery", 1);</script>
<script type="text/javascript">

var videos = null;
var start = Math.pow(2, 32);
var end = 0;

$(document).ready(function(){
    //$(".video").mousemove(function(event){
    $(".video").live("mousemove", function(event){
        var videoid = $(this).attr("data-video");

        // Calculate the X offset of the cursor within this video, as a float between 0 and 1.
        var width = $(this).width();
        var pos = event.offsetX / width;

        // Calculate the approximate timestamp in the video that corresponds to the position of the mouse cursor.
        var start = videos[videoid]['start'];
        var end = videos[videoid]['end'];
        var timestamp = start + ((end - start) * pos);

        // Display this timestamp.
        d = new Date();
        d.setTime(timestamp * 1000);
        $("#cursor").html("" + d);
        $("#cursor").css('left', event.pageX - ($("#cursor").width() / 2));

        // Load a new frame from the video.
        if($('img#frame').attr('src') != '/video/' + videoid + '/' + timestamp)
            $('img#frame').attr('src', '/video/' + videoid + '/' + timestamp);
    });


    $.getJSON("/video/", {}, function(data){
        videos = data;

        // Calculate total size.
        var size = 0;
        for(var index in data)
            size += data[index]['size'];

        for(var index in data)
        {
            // Make a video object in the timeline.
            var videospan = $('<span>');

            videospan.attr('data-video', index);

            videospan.addClass('video');
            videospan.css('width', ((data[index]['size'] / size) * 100) + "%");
            videospan.text("video");
            $("#timeline").append(videospan);

        }
     });
    
});

</script>
<style type="text/css">

img#frame
{
    border: 1px solid black;
    padding: 1px;
    margin: 10px auto 10px auto;
}

div#timeline
{
    width: 90%;
    height: 20px;
    border: 1px solid black;
    background: #cccccc;
    margin: 10px auto 40px auto;
}

span#cursor
{
    height: 20px;
    position: absolute;
    top: 50px;
    font-family: sans;
    font-size: 12px;
    display: inline-block;
}

span.video
{
   display: table-cell;
   background: #00CC00;
   border: 1px solid blue;
}

</style>
</head>
<body>

<div id="timeline"></div>
<span id="cursor"></span>

<img id="frame" />


</body>
</html>
